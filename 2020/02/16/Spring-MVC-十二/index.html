<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Spring-MVC(十二) | DK</title><meta name="description" content="Spring MVC"><meta name="keywords" content="Spring MVC,Ajax&amp;数据转换"><meta name="author" content="D G"><meta name="copyright" content="D G"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/ducamg/PicGallery@master/DG-PIC/logo/logo.ico"><link rel="canonical" href="https://ducamg0503.github.io/2020/02/16/Spring-MVC-%E5%8D%81%E4%BA%8C/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Spring-MVC(十二)"><meta property="og:url" content="https://ducamg0503.github.io/2020/02/16/Spring-MVC-%E5%8D%81%E4%BA%8C/"><meta property="og:site_name" content="DK"><meta property="og:description" content="Spring MVC"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/ducamg/PicGallery@master/DG-PIC/cover/spring_mvc.jpg"><meta property="article:published_time" content="2020-02-16T08:40:55.000Z"><meta property="article:modified_time" content="2020-09-07T01:06:09.613Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.1.1',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-09-07 09:06:09'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 5.1.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" data-lazy-src="https://cdn.jsdelivr.net/gh/ducamg/PicGallery@master/DG-PIC/logo/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">37</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">27</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">28</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2-amp-%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%8C%96-amp-%E6%95%B0%E6%8D%AE%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.</span> <span class="toc-text">数据转换&amp;数据格式化&amp;数据校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.1.</span> <span class="toc-text">数据转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E5%B8%A6%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.</span> <span class="toc-text">发送带请求参数的数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="toc-number">1.3.</span> <span class="toc-text">自定义类型转换器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">1.4.</span> <span class="toc-text">数据格式化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.5.</span> <span class="toc-text">数据校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E6%A0%A1%E9%AA%8C%E6%98%AF%E4%B8%8D%E5%AE%89%E5%85%A8%E7%9A%84%EF%BC%8C%E9%87%8D%E8%A6%81%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%80%E5%AE%9A%E8%A6%81%E5%8A%A0%E4%B8%8A%E5%90%8E%E7%AB%AF%E9%AA%8C%E8%AF%81"><span class="toc-number">1.6.</span> <span class="toc-text">前端校验是不安全的，重要的数据一定要加上后端验证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lt-mvc-annotation-driven%E2%80%9D-gt"><span class="toc-number">2.</span> <span class="toc-text">&lt;mvc:annotation-driven”&#x2F;&gt;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E4%B8%A4%E4%B8%AA%E6%A0%87%E7%AD%BE%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">2.1.</span> <span class="toc-text">加入两个标签的作用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Ajax"><span class="toc-number">3.</span> <span class="toc-text">Ajax</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#json%E6%95%B0%E6%8D%AE"><span class="toc-number">3.1.</span> <span class="toc-text">json数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="toc-number">3.2.</span> <span class="toc-text">获取请求头</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6%E5%93%8D%E5%BA%94%E5%A4%B4"><span class="toc-number">3.3.</span> <span class="toc-text">定制响应头</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringMVC-%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD"><span class="toc-number">4.</span> <span class="toc-text">SpringMVC 文件下载</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringMVCMVC%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">4.1.</span> <span class="toc-text">SpringMVCMVC文件上传</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/ducamg/PicGallery@master/DG-PIC/cover/spring_mvc.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">DK</a></span><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Spring-MVC(十二)</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-02-16T08:40:55.000Z" title="发表于 2020-02-16 16:40:55">2020-02-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-09-07T01:06:09.613Z" title="更新于 2020-09-07 09:06:09">2020-09-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Spring-MVC/">Spring MVC</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Spring-MVC/Ajax-%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2/">Ajax&amp;数据转换</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="数据转换-amp-数据格式化-amp-数据校验"><a href="#数据转换-amp-数据格式化-amp-数据校验" class="headerlink" title="数据转换&amp;数据格式化&amp;数据校验"></a>数据转换&amp;数据格式化&amp;数据校验</h2><h3 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a>数据转换</h3><ol>
<li>数据绑定期间的数据类型转换  String–Integer  String–Boolean</li>
</ol>
<h3 id="发送带请求参数的数据"><a href="#发送带请求参数的数据" class="headerlink" title="发送带请求参数的数据"></a>发送带请求参数的数据</h3><ul>
<li><p>java</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 发送请求带的数据</span></span><br><span class="line"><span class="comment">*      quickadd?empinfo=empAdmin-admin@gmail.com-1-101</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*      <span class="doctag">@RequestParam</span>(&quot;empinfo&quot;) Employee employee</span></span><br><span class="line"><span class="comment">*      Employee employee = request.getParam(&quot;empinfo&quot;)</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*   可以通过写一个自定义类型的转换器让其工作</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/quickadd&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">quickAdd</span><span class="params">(<span class="meta">@RequestParam(&quot;empinfo&quot;)</span> Employee employee)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;封装:&quot;</span>+employee);</span><br><span class="line">    employeeDao.save(employee);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;forward:emps&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>html</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;$&#123;ctp&#125;/quickadd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 将员工信息都写上自动封装对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;empinfo&quot;</span> <span class="attr">value</span>=<span class="string">&quot;empAdmin-admin@gmail.com-1-101&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;快速添加&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>问题</p>
<ol>
<li>参数为[<a href="mailto:&#101;&#x6d;&#112;&#65;&#100;&#x6d;&#105;&#110;&#x2d;&#97;&#100;&#x6d;&#x69;&#110;&#64;&#x67;&#109;&#x61;&#105;&#x6c;&#x2e;&#x63;&#111;&#109;&#45;&#49;&#x2d;&#x31;&#48;&#49;">&#101;&#x6d;&#112;&#65;&#100;&#x6d;&#105;&#110;&#x2d;&#97;&#100;&#x6d;&#x69;&#110;&#64;&#x67;&#109;&#x61;&#105;&#x6c;&#x2e;&#x63;&#111;&#109;&#45;&#49;&#x2d;&#x31;&#48;&#49;</a>]封装Employee对象会封装错误:自定义类型转换器</li>
</ol>
</li>
</ul>
<h3 id="自定义类型转换器"><a href="#自定义类型转换器" class="headerlink" title="自定义类型转换器"></a>自定义类型转换器</h3><ul>
<li><p>步骤</p>
<ol>
<li><p>ConversionService:是一个接口</br><br> 里面有Convertor进行工作</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Converter</span>&lt;<span class="title">S</span>, <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function">T <span class="title">convert</span><span class="params">(S source)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>实现Convertor接口，写一个自定义类型转换器</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">myStringtoEmployeeConverter</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>, <span class="title">Employee</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DepartmentDao departmentDao;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 自定义的转化规则</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> s</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Employee <span class="title">convert</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//empAdmin-admin@gmail.com-1-101</span></span><br><span class="line">        System.out.println(<span class="string">&quot;页面提交的字符串:&quot;</span>+s);</span><br><span class="line">        Employee employee = <span class="keyword">new</span> Employee();</span><br><span class="line">        <span class="keyword">if</span> (s.contains(<span class="string">&quot;-&quot;</span>))&#123;</span><br><span class="line">            String[] split = s.split(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">            employee.setLastName(split[<span class="number">0</span>]);</span><br><span class="line">            employee.setEmail(split[<span class="number">1</span>]);</span><br><span class="line">            employee.setGender(Integer.parseInt(split[<span class="number">2</span>]));</span><br><span class="line">            employee.setDepartment(departmentDao.getDepatment(Integer.parseInt(split[<span class="number">3</span>])));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> employee;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义的Converter必须放入ConverterService</p>
</li>
<li><p>将WebDataBinder中的ConversionService设置为自定义类型转换器的ConversionService</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 自定义类新转换器建议使用 FormattingConversionServiceFactoryBean 来注册，具有类型转化还有格式化--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;formattingConversionService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;converters&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;ducam.gold.component.myStringtoEmployeeConverter&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用自定义的ConversionService</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--使用自己配置的类型转换组件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">&quot;formattingConversionService&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ul>
<h3 id="数据格式化"><a href="#数据格式化" class="headerlink" title="数据格式化"></a>数据格式化</h3><ol>
<li><p>数据绑定期间的格式化 比如日期转换  birth-2017-12-25—Date 2017/12/25</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line"><span class="meta">@JsonFormat(pattern = &quot;yyyy-mm-dd&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Date bitrh = <span class="keyword">new</span> Date();</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ConversionServiceFactoryBean:创建的ConversionService组件没有格式化</br><br>  使用 FormattingConversionServiceFactoryBean</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 自定义类新转换器建议使用 FormattingConversionServiceFactoryBean 来注册，具有类型转化还有格式化--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;formattingConversionService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;converters&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;ducam.gold.component.myStringtoEmployeeConverter&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ol>
<h3 id="数据校验"><a href="#数据校验" class="headerlink" title="数据校验"></a>数据校验</h3><ol>
<li>数据校验<ul>
<li>我们提交的数据必须是合法的</li>
<li>前端校验:js+正则表达式</li>
<li>后端校验:重要的数据必须进行校验<ol>
<li>数据合法：校验成功</li>
<li>数据非法：校验失败</li>
</ol>
</li>
</ul>
</li>
</ol>
<h3 id="前端校验是不安全的，重要的数据一定要加上后端验证"><a href="#前端校验是不安全的，重要的数据一定要加上后端验证" class="headerlink" title="前端校验是不安全的，重要的数据一定要加上后端验证"></a>前端校验是不安全的，重要的数据一定要加上后端验证</h3><ol>
<li><p><del>可以写程序将我们每一个数据取出进行校验，如果失败直接来到添加页面提示重新填写</del></p>
</li>
<li><p>SpringMVC:可以利用JSR303进行数据校验<br> </br>JDBC:规范—-实现(各个厂商的驱动包)<br> </br>JSR303:规范—Hibernate Validator(第三方校验框架)</p>
</li>
<li><p>快速的进行后端校验</p>
<ol>
<li><p>导入检验的框架包  </p>
<ul>
<li>hibernate-validator-6.1.2.Final.jar</li>
<li>hibernate-validator-annotation-processor-6.1.2.Final.jar</li>
<li>classmate-1.3.4.jar</li>
<li>jboss-logging-3.3.2.Final.jar</li>
<li>jakarta.validation-api-2.0.2.jar</li>
</ul>
</li>
<li><p>给javabean的属性添加校验注解</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Length(min = 6,max = 18)</span></span><br><span class="line"> <span class="meta">@NotNull</span></span><br><span class="line"> <span class="keyword">private</span>  String lastName;</span><br><span class="line"> <span class="meta">@Email</span></span><br><span class="line"> <span class="keyword">private</span> String email;</span><br><span class="line"> <span class="meta">@Past</span>   <span class="comment">//必须是一个过去的时间</span></span><br><span class="line"> <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line"> <span class="keyword">private</span> Date bitrh;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在SpringMVC封装对象的时候加上@Valid注解</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/emp&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">addEmp</span><span class="params">(<span class="meta">@Valid</span> Employee employee)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;要添加的员工:&quot;</span>+employee);</span><br><span class="line">    employeeDao.save(employee);  </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/emps&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>校验结果：给需要的需要娇艳的javaBean后面跟一个BindingResult.</br><br> 这个BindingResult就是封装了校验结果</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/emp&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">addEmp</span><span class="params">(<span class="meta">@Valid</span> Employee employee, BindingResult bindingResult)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;要添加的员工:&quot;</span>+employee);</span><br><span class="line">    employeeDao.save(employee);</span><br><span class="line">    <span class="comment">//返回列表页面  直接重定向到查询所有员工的请求</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/emps&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>根据不同的校验结果，来处理</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/emp&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">addEmp</span><span class="params">(<span class="meta">@Valid</span> Employee employee, BindingResult bindingResult)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;要添加的员工:&quot;</span>+employee);</span><br><span class="line">    <span class="keyword">boolean</span> b = bindingResult.hasErrors();</span><br><span class="line">    <span class="keyword">if</span> (b)&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;有校验错误！&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ADD_EMPLOYEE;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        employeeDao.save(employee);</span><br><span class="line">        <span class="comment">//返回列表页面  直接重定向到查询所有员工的请求</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;redirect:/emps&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">lastName:&lt;form:input path=<span class="string">&quot;lastName&quot;</span>/&gt;&lt;form:errors path=<span class="string">&quot;lastName&quot;</span>/&gt; &lt;br&gt;</span><br><span class="line">email:&lt;form:input path=<span class="string">&quot;email&quot;</span>/&gt;&lt;form:errors path=<span class="string">&quot;email&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">gender:&lt;br&gt;</span><br><span class="line">    男:&lt;form:radiobutton path=<span class="string">&quot;gender&quot;</span> value=<span class="string">&quot;1&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">    女:&lt;form:radiobutton path=<span class="string">&quot;gender&quot;</span> value=<span class="string">&quot;0&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">birth:&lt;form:input path=<span class="string">&quot;bitrh&quot;</span> /&gt;&lt;form:errors path=<span class="string">&quot;bitrh&quot;</span>/&gt;&lt;br&gt;</span><br><span class="line">&lt;!-- items:指定遍历的集合,自动遍历，遍历出每一个元素是一个department对象</span><br><span class="line">    itemLabel=<span class="string">&quot;属性&quot;</span>  指定遍历出的这个对象的哪个属性是作为option标签体的值</span><br><span class="line">    itemValue=<span class="string">&quot;属性&quot;</span>  指定遍历出的这个对象的哪个属性作为要提交的value值</span><br><span class="line">--&gt;</span><br><span class="line">dept:&lt;form:select path=&quot;department.id&quot; items=&quot;$&#123;depts&#125;&quot; itemLabel=&quot;departmentName&quot; itemValue=&quot;id&quot;&gt;&lt;/form:select&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>原生表单放在请求域中</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/emp&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">addEmp</span><span class="params">(<span class="meta">@Valid</span> Employee employee, BindingResult bindingResult,Model model)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;要添加的员工:&quot;</span>+employee);</span><br><span class="line">    <span class="keyword">boolean</span> b = bindingResult.hasErrors();</span><br><span class="line">    Map&lt;String,Object&gt; errors= <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (b)&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;有校验错误！&quot;</span>);</span><br><span class="line">        List&lt;FieldError&gt; fieldErrors = bindingResult.getFieldErrors();</span><br><span class="line">        <span class="keyword">for</span> (FieldError fieldError : fieldErrors) &#123;</span><br><span class="line">                errors.put(fieldError.getField(),fieldError.getDefaultMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将校验错误信息放入请求域中</span></span><br><span class="line">        model.addAttribute(<span class="string">&quot;errorInfo&quot;</span>,errors);</span><br><span class="line">            <span class="keyword">return</span> ADD_EMPLOYEE;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">         employeeDao.save(employee);</span><br><span class="line">        <span class="comment">//返回列表页面  直接重定向到查询所有员工的请求</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;/emps.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>国际化定制定制错误消息<br></br>编写国际化配置文件</p>
<ol>
<li><p>key= length must be between 6 and 18中的key有规定</p>
<ul>
<li>每一个字段发送错误以后，都会有自己的错误代码；国际化文件中的错误消息的key必须对应一个错误代码<br>(Length.java.lang.String = length incorrect,must between {2} and {1})</li>
</ul>
</li>
<li><p>让SpringMVC管理配置文件</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 管理国际化资源文件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;</span> <span class="attr">id</span>=<span class="string">&quot;messageSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basename&quot;</span> <span class="attr">value</span>=<span class="string">&quot;errors&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="lt-mvc-annotation-driven”-gt"><a href="#lt-mvc-annotation-driven”-gt" class="headerlink" title="&lt;mvc:annotation-driven”/&gt;"></a>&lt;mvc:annotation-driven”/&gt;</h2><ol>
<li><p>加入 &lt;mvc:annotation-driven/&gt; 自动加入三个组件</p>
<ul>
<li>RequestMapping HandlerMapping</li>
<li>RequestMapping HandlerAdapter</li>
<li>ExceptionHandler ExceptionResolver</li>
</ul>
</li>
<li><p>提供一下支持</p>
<ul>
<li>支持使用ConversionService实例表单参数进行类型转换</li>
<li>支持使用 @NumberFormat annotation @DateTimeFormat注解完成数据类型格式化</li>
<li>支持使用 @Valid注解对Javabean实例进行JSR 303验证</li>
<li>支持使用 @RequestBody和 @ResponseBody注解</li>
</ul>
</li>
<li><p>code</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//class AnnotationDrivenBeanDefinitionParser implements BeanDefinitionParser &#123;</span></span><br><span class="line"><span class="comment">//加入了很多组件</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BeanDefinition <span class="title">parse</span><span class="params">(Element element, ParserContext context)</span> </span>&#123;</span><br><span class="line">    Object source = context.extractSource(element);</span><br><span class="line">    XmlReaderContext readerContext = context.getReaderContext();</span><br><span class="line"></span><br><span class="line">    CompositeComponentDefinition compDefinition = <span class="keyword">new</span> CompositeComponentDefinition(element.getTagName(), source);</span><br><span class="line">    context.pushContainingComponent(compDefinition);</span><br><span class="line"></span><br><span class="line">    RuntimeBeanReference contentNegotiationManager = getContentNegotiationManager(element, source, context);</span><br><span class="line"></span><br><span class="line">    RootBeanDefinition handlerMappingDef = <span class="keyword">new</span> RootBeanDefinition(RequestMappingHandlerMapping.class);</span><br><span class="line">    handlerMappingDef.setSource(source);</span><br><span class="line">    handlerMappingDef.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</span><br><span class="line">    handlerMappingDef.getPropertyValues().add(<span class="string">&quot;order&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    handlerMappingDef.getPropertyValues().add(<span class="string">&quot;contentNegotiationManager&quot;</span>, contentNegotiationManager);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (element.hasAttribute(<span class="string">&quot;enable-matrix-variables&quot;</span>)) &#123;</span><br><span class="line">        Boolean enableMatrixVariables = Boolean.valueOf(element.getAttribute(<span class="string">&quot;enable-matrix-variables&quot;</span>));</span><br><span class="line">        handlerMappingDef.getPropertyValues().add(<span class="string">&quot;removeSemicolonContent&quot;</span>, !enableMatrixVariables);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    configurePathMatchingProperties(handlerMappingDef, element, context);</span><br><span class="line">    readerContext.getRegistry().registerBeanDefinition(HANDLER_MAPPING_BEAN_NAME, handlerMappingDef);</span><br><span class="line"></span><br><span class="line">    RuntimeBeanReference corsRef = MvcNamespaceUtils.registerCorsConfigurations(<span class="keyword">null</span>, context, source);</span><br><span class="line">    handlerMappingDef.getPropertyValues().add(<span class="string">&quot;corsConfigurations&quot;</span>, corsRef);</span><br><span class="line"></span><br><span class="line">    RuntimeBeanReference conversionService = getConversionService(element, source, context);</span><br><span class="line">    RuntimeBeanReference validator = getValidator(element, source, context);</span><br><span class="line">    RuntimeBeanReference messageCodesResolver = getMessageCodesResolver(element);</span><br><span class="line"></span><br><span class="line">    RootBeanDefinition bindingDef = <span class="keyword">new</span> RootBeanDefinition(ConfigurableWebBindingInitializer.class);</span><br><span class="line">    bindingDef.setSource(source);</span><br><span class="line">    bindingDef.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</span><br><span class="line">    bindingDef.getPropertyValues().add(<span class="string">&quot;conversionService&quot;</span>, conversionService);</span><br><span class="line">    bindingDef.getPropertyValues().add(<span class="string">&quot;validator&quot;</span>, validator);</span><br><span class="line">    bindingDef.getPropertyValues().add(<span class="string">&quot;messageCodesResolver&quot;</span>, messageCodesResolver);</span><br><span class="line"></span><br><span class="line">    ManagedList&lt;?&gt; messageConverters = getMessageConverters(element, source, context);</span><br><span class="line">    ManagedList&lt;?&gt; argumentResolvers = getArgumentResolvers(element, context);</span><br><span class="line">    ManagedList&lt;?&gt; returnValueHandlers = getReturnValueHandlers(element, context);</span><br><span class="line">    String asyncTimeout = getAsyncTimeout(element);</span><br><span class="line">    RuntimeBeanReference asyncExecutor = getAsyncExecutor(element);</span><br><span class="line">    ManagedList&lt;?&gt; callableInterceptors = getInterceptors(element, source, context, <span class="string">&quot;callable-interceptors&quot;</span>);</span><br><span class="line">    ManagedList&lt;?&gt; deferredResultInterceptors = getInterceptors(element, source, context, <span class="string">&quot;deferred-result-interceptors&quot;</span>);</span><br><span class="line"></span><br><span class="line">    RootBeanDefinition handlerAdapterDef = <span class="keyword">new</span> RootBeanDefinition(RequestMappingHandlerAdapter.class);</span><br><span class="line">    handlerAdapterDef.setSource(source);</span><br><span class="line">    handlerAdapterDef.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</span><br><span class="line">    handlerAdapterDef.getPropertyValues().add(<span class="string">&quot;contentNegotiationManager&quot;</span>, contentNegotiationManager);</span><br><span class="line">    handlerAdapterDef.getPropertyValues().add(<span class="string">&quot;webBindingInitializer&quot;</span>, bindingDef);</span><br><span class="line">    handlerAdapterDef.getPropertyValues().add(<span class="string">&quot;messageConverters&quot;</span>, messageConverters);</span><br><span class="line">    addRequestBodyAdvice(handlerAdapterDef);</span><br><span class="line">    addResponseBodyAdvice(handlerAdapterDef);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (element.hasAttribute(<span class="string">&quot;ignore-default-model-on-redirect&quot;</span>)) &#123;</span><br><span class="line">        Boolean ignoreDefaultModel = Boolean.valueOf(element.getAttribute(<span class="string">&quot;ignore-default-model-on-redirect&quot;</span>));</span><br><span class="line">        handlerAdapterDef.getPropertyValues().add(<span class="string">&quot;ignoreDefaultModelOnRedirect&quot;</span>, ignoreDefaultModel);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (argumentResolvers != <span class="keyword">null</span>) &#123;</span><br><span class="line">        handlerAdapterDef.getPropertyValues().add(<span class="string">&quot;customArgumentResolvers&quot;</span>, argumentResolvers);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (returnValueHandlers != <span class="keyword">null</span>) &#123;</span><br><span class="line">        handlerAdapterDef.getPropertyValues().add(<span class="string">&quot;customReturnValueHandlers&quot;</span>, returnValueHandlers);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (asyncTimeout != <span class="keyword">null</span>) &#123;</span><br><span class="line">        handlerAdapterDef.getPropertyValues().add(<span class="string">&quot;asyncRequestTimeout&quot;</span>, asyncTimeout);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (asyncExecutor != <span class="keyword">null</span>) &#123;</span><br><span class="line">        handlerAdapterDef.getPropertyValues().add(<span class="string">&quot;taskExecutor&quot;</span>, asyncExecutor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    handlerAdapterDef.getPropertyValues().add(<span class="string">&quot;callableInterceptors&quot;</span>, callableInterceptors);</span><br><span class="line">    handlerAdapterDef.getPropertyValues().add(<span class="string">&quot;deferredResultInterceptors&quot;</span>, deferredResultInterceptors);</span><br><span class="line">    readerContext.getRegistry().registerBeanDefinition(HANDLER_ADAPTER_BEAN_NAME, handlerAdapterDef);</span><br><span class="line"></span><br><span class="line">    RootBeanDefinition uriContributorDef =</span><br><span class="line">            <span class="keyword">new</span> RootBeanDefinition(CompositeUriComponentsContributorFactoryBean.class);</span><br><span class="line">    uriContributorDef.setSource(source);</span><br><span class="line">    uriContributorDef.getPropertyValues().addPropertyValue(<span class="string">&quot;handlerAdapter&quot;</span>, handlerAdapterDef);</span><br><span class="line">    uriContributorDef.getPropertyValues().addPropertyValue(<span class="string">&quot;conversionService&quot;</span>, conversionService);</span><br><span class="line">    String uriContributorName = MvcUriComponentsBuilder.MVC_URI_COMPONENTS_CONTRIBUTOR_BEAN_NAME;</span><br><span class="line">    readerContext.getRegistry().registerBeanDefinition(uriContributorName, uriContributorDef);</span><br><span class="line"></span><br><span class="line">    RootBeanDefinition csInterceptorDef = <span class="keyword">new</span> RootBeanDefinition(ConversionServiceExposingInterceptor.class);</span><br><span class="line">    csInterceptorDef.setSource(source);</span><br><span class="line">    csInterceptorDef.getConstructorArgumentValues().addIndexedArgumentValue(<span class="number">0</span>, conversionService);</span><br><span class="line">    RootBeanDefinition mappedInterceptorDef = <span class="keyword">new</span> RootBeanDefinition(MappedInterceptor.class);</span><br><span class="line">    mappedInterceptorDef.setSource(source);</span><br><span class="line">    mappedInterceptorDef.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</span><br><span class="line">    mappedInterceptorDef.getConstructorArgumentValues().addIndexedArgumentValue(<span class="number">0</span>, (Object) <span class="keyword">null</span>);</span><br><span class="line">    mappedInterceptorDef.getConstructorArgumentValues().addIndexedArgumentValue(<span class="number">1</span>, csInterceptorDef);</span><br><span class="line">    String mappedInterceptorName = readerContext.registerWithGeneratedName(mappedInterceptorDef);</span><br><span class="line"></span><br><span class="line">    RootBeanDefinition methodExceptionResolver = <span class="keyword">new</span> RootBeanDefinition(ExceptionHandlerExceptionResolver.class);</span><br><span class="line">    methodExceptionResolver.setSource(source);</span><br><span class="line">    methodExceptionResolver.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</span><br><span class="line">    methodExceptionResolver.getPropertyValues().add(<span class="string">&quot;contentNegotiationManager&quot;</span>, contentNegotiationManager);</span><br><span class="line">    methodExceptionResolver.getPropertyValues().add(<span class="string">&quot;messageConverters&quot;</span>, messageConverters);</span><br><span class="line">    methodExceptionResolver.getPropertyValues().add(<span class="string">&quot;order&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    addResponseBodyAdvice(methodExceptionResolver);</span><br><span class="line">    <span class="keyword">if</span> (argumentResolvers != <span class="keyword">null</span>) &#123;</span><br><span class="line">        methodExceptionResolver.getPropertyValues().add(<span class="string">&quot;customArgumentResolvers&quot;</span>, argumentResolvers);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (returnValueHandlers != <span class="keyword">null</span>) &#123;</span><br><span class="line">        methodExceptionResolver.getPropertyValues().add(<span class="string">&quot;customReturnValueHandlers&quot;</span>, returnValueHandlers);</span><br><span class="line">    &#125;</span><br><span class="line">    String methodExResolverName = readerContext.registerWithGeneratedName(methodExceptionResolver);</span><br><span class="line"></span><br><span class="line">    RootBeanDefinition statusExceptionResolver = <span class="keyword">new</span> RootBeanDefinition(ResponseStatusExceptionResolver.class);</span><br><span class="line">    statusExceptionResolver.setSource(source);</span><br><span class="line">    statusExceptionResolver.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</span><br><span class="line">    statusExceptionResolver.getPropertyValues().add(<span class="string">&quot;order&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    String statusExResolverName = readerContext.registerWithGeneratedName(statusExceptionResolver);</span><br><span class="line"></span><br><span class="line">    RootBeanDefinition defaultExceptionResolver = <span class="keyword">new</span> RootBeanDefinition(DefaultHandlerExceptionResolver.class);</span><br><span class="line">    defaultExceptionResolver.setSource(source);</span><br><span class="line">    defaultExceptionResolver.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);</span><br><span class="line">    defaultExceptionResolver.getPropertyValues().add(<span class="string">&quot;order&quot;</span>, <span class="number">2</span>);</span><br><span class="line">    String defaultExResolverName = readerContext.registerWithGeneratedName(defaultExceptionResolver);</span><br><span class="line"></span><br><span class="line">    context.registerComponent(<span class="keyword">new</span> BeanComponentDefinition(handlerMappingDef, HANDLER_MAPPING_BEAN_NAME));</span><br><span class="line">    context.registerComponent(<span class="keyword">new</span> BeanComponentDefinition(handlerAdapterDef, HANDLER_ADAPTER_BEAN_NAME));</span><br><span class="line">    context.registerComponent(<span class="keyword">new</span> BeanComponentDefinition(uriContributorDef, uriContributorName));</span><br><span class="line">    context.registerComponent(<span class="keyword">new</span> BeanComponentDefinition(mappedInterceptorDef, mappedInterceptorName));</span><br><span class="line">    context.registerComponent(<span class="keyword">new</span> BeanComponentDefinition(methodExceptionResolver, methodExResolverName));</span><br><span class="line">    context.registerComponent(<span class="keyword">new</span> BeanComponentDefinition(statusExceptionResolver, statusExResolverName));</span><br><span class="line">    context.registerComponent(<span class="keyword">new</span> BeanComponentDefinition(defaultExceptionResolver, defaultExResolverName));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ensure BeanNameUrlHandlerMapping (SPR-8289) and default HandlerAdapters are not &quot;turned off&quot;</span></span><br><span class="line">    MvcNamespaceUtils.registerDefaultComponents(context, source);</span><br><span class="line"></span><br><span class="line">    context.popAndRegisterContainingComponent();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="加入两个标签的作用"><a href="#加入两个标签的作用" class="headerlink" title="加入两个标签的作用"></a>加入两个标签的作用</h3><ol>
<li><p>xml</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li><p>都没配</p>
<ol>
<li>动态资源(@RequestMapping映射资源可以访问)</li>
<li>静态资源(.html .js .img)都不能访问</li>
</ol>
</li>
<li><p>引入&lt;mvc:default-servlet-handler/&gt;</p>
<ol>
<li>静态资源可以访问</li>
<li>动态资源不能访问</li>
</ol>
</li>
<li><p>都引入</p>
<ol>
<li>静态资源和动态资源才能访问</li>
</ol>
</li>
</ul>
<h2 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h2><ol>
<li>SpringMVC快速完成Ajax功能<ol>
<li>返回的数据是json数据就可以</li>
<li>页面 $.ajax();</li>
</ol>
</li>
<li>原生的JavaWeb<ol>
<li>导入GSON;</li>
<li>返回的数据转成json</li>
<li>写出去</li>
</ol>
</li>
<li>SpringMVC-ajax<ol>
<li>导包<ul>
<li>jackson-annotations-2.10.2.jar</li>
<li>jackson-core-2.10.2.jar</li>
<li>jackson-databind-2.10.2.jar</li>
</ul>
</li>
<li>写配置</li>
<li>测试</li>
</ol>
</li>
</ol>
<h3 id="json数据"><a href="#json数据" class="headerlink" title="json数据"></a>json数据</h3><ol>
<li><p>发送json数据</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 将返回的数据放在响应体中，</span></span><br><span class="line"><span class="comment">* 如果返回的是对象，Jackson自动将对象转为json格式</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@ResponseBody</span> <span class="comment">//返回json数据</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/getallajax&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Collection&lt;Employee&gt; <span class="title">ajaxGetAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Collection&lt;Employee&gt; all = employeeDao.getAll();</span><br><span class="line">    <span class="keyword">return</span> all;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;$&#123;ctp&#125;/getallajax&quot;&gt;getAllajax&lt;/a&gt;&lt;br&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ajax发送json数据</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@ResponseBody</span> 把对象转为json数据,返回给浏览器</span></span><br><span class="line"><span class="comment">* <span class="doctag">@RequestBody</span>：接受json数据封装为对象</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> employee</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/testRequestBody02&quot;,method = RequestMethod.POST)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testRequestBody02</span><span class="params">(<span class="meta">@RequestBody</span> Employee employee)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;请求体:&quot;</span>+employee);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;$&#123;ctp&#125;/testRequestBody02&quot;&gt;ajax发送json数据&lt;/a&gt;&lt;br&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    $(<span class="string">&quot;a:first&quot;</span>).click(function () &#123;</span><br><span class="line">        <span class="comment">//点击发送ajax请求，请求带的是json数据</span></span><br><span class="line">        <span class="keyword">var</span>  emp = &#123;    lastName:<span class="string">&quot;张三&quot;</span>,</span><br><span class="line">                        email:<span class="string">&quot;aaa@qq.com&quot;</span>,</span><br><span class="line">                        gender:<span class="number">0</span></span><br><span class="line">                    &#125;;</span><br><span class="line">        <span class="comment">// alert(typeof emp);  对象</span></span><br><span class="line">        <span class="comment">//json对象</span></span><br><span class="line">        <span class="keyword">var</span> empStr = JSON.stringify(emp);</span><br><span class="line">        <span class="comment">// alert(typeof empStr);  //字符串</span></span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            url:<span class="string">&quot;$&#123;ctp&#125;/testRequestBody02&quot;</span>,</span><br><span class="line">            type:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">            data: empStr,</span><br><span class="line">            contentType:<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">            success:function (data) &#123;</span><br><span class="line">                alert(data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="获取请求头"><a href="#获取请求头" class="headerlink" title="获取请求头"></a>获取请求头</h3><ol>
<li><p>在方法参数中添加HttpEntity可以获取请求头</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test05&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test01</span><span class="params">(HttpEntity&lt;String&gt; stringHttpEntity)</span></span>&#123;</span><br><span class="line">    <span class="comment">//获取到请求头</span></span><br><span class="line">    System.out.println(<span class="string">&quot;请求头：&quot;</span>+stringHttpEntity);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="定制响应头"><a href="#定制响应头" class="headerlink" title="定制响应头"></a>定制响应头</h3><ol>
<li><p>ResponseEntity</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 定制响应头</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test06&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">test05</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String body = <span class="string">&quot;&lt;h1&gt;success&lt;/h1&gt;&quot;</span>;</span><br><span class="line">    MultiValueMap&lt;String, String&gt; header = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">    header.add(<span class="string">&quot;Set-Cookie&quot;</span>,<span class="string">&quot;username=duacmgold&quot;</span>);</span><br><span class="line">    HttpStatus httpStatus = HttpStatus.OK;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;String&gt;(body,header,httpStatus);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="SpringMVC-文件下载"><a href="#SpringMVC-文件下载" class="headerlink" title="SpringMVC 文件下载"></a>SpringMVC 文件下载</h2><ol>
<li><p>文件下载</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/download&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;<span class="keyword">byte</span>[]&gt; download(HttpServletRequest request) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">//得到文件下载的流</span></span><br><span class="line">    <span class="comment">//找到下载文件的真实路径</span></span><br><span class="line">    ServletContext servletContext = request.getServletContext();</span><br><span class="line">    String realPath = servletContext.getRealPath(<span class="string">&quot;/WEB-INF/download/1.txt&quot;</span>);</span><br><span class="line">    FileInputStream fileInputStream = <span class="keyword">new</span> FileInputStream(realPath);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">byte</span>[] tmp = <span class="keyword">new</span> <span class="keyword">byte</span>[fileInputStream.available()];</span><br><span class="line">    fileInputStream.read(tmp);</span><br><span class="line">    fileInputStream.close();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将要下载的文件返回</span></span><br><span class="line">    MultiValueMap&lt;String, String&gt; headers = <span class="keyword">new</span> HttpHeaders();</span><br><span class="line">    headers.set(<span class="string">&quot;Content-disposition&quot;</span>,<span class="string">&quot;attachment;filename=&quot;</span>+<span class="string">&quot;1.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>  <span class="keyword">new</span> ResponseEntity&lt;<span class="keyword">byte</span>[]&gt;(tmp,headers,HttpStatus.OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="SpringMVCMVC文件上传"><a href="#SpringMVCMVC文件上传" class="headerlink" title="SpringMVCMVC文件上传"></a>SpringMVCMVC文件上传</h3><ol>
<li><p>文件上传表单准备:enctype=”multipart/form-data”</p>
 <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    用户头像:&lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;headerimg&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">    用户名:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span>/&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>导入jar包</p>
<ul>
<li>commons-fileupload-1.4.jar  </li>
<li>commons-io-2.6.jar</li>
</ul>
</li>
<li><p>在SpringMVC配置文件，配置文件上传解析器(MultipartResolver)</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置文件上传解析器  id必须是multipartResolver 因为  this.multipartResolver = (MultipartResolver)context.getBean(&quot;multipartResolver&quot;, MultipartResolver.class);   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxUploadSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;1024*1024*20&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--            默认编码--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;defaultEncoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>文件上传处理请求<br> </br>@RequestParam(value = “headerimg”,required = false)MultipartFile file<br> </br>封装了当前文件的信息</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileUploadController</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        //单文件上传</span></span><br><span class="line"><span class="comment">        @RequestMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="comment">        public String upload(@RequestParam(value = &quot;username&quot;,required = false) String username,</span></span><br><span class="line"><span class="comment">                            @RequestParam(value = &quot;headerimg&quot;,required = false)MultipartFile file</span></span><br><span class="line"><span class="comment">                ,Model model)&#123;</span></span><br><span class="line"><span class="comment">            System.out.println(&quot;文件的信息----&quot;);</span></span><br><span class="line"><span class="comment">            System.out.println(&quot;文件项的名:&quot;+file.getName());</span></span><br><span class="line"><span class="comment">            System.out.println(&quot;文件名:&quot;+file.getOriginalFilename());</span></span><br><span class="line"><span class="comment">            System.out.println(&quot;文件的大小:&quot;+file.getSize());</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            //文件保存</span></span><br><span class="line"><span class="comment">            try &#123;</span></span><br><span class="line"><span class="comment">                file.transferTo(new File(&quot;G:\\fileupload\\&quot;+file.getOriginalFilename()));</span></span><br><span class="line"><span class="comment">                model.addAttribute(&quot;msg&quot;,&quot;文件上传成功！&quot;);</span></span><br><span class="line"><span class="comment">            &#125; catch (IOException e) &#123;</span></span><br><span class="line"><span class="comment">                model.addAttribute(&quot;msg&quot;,&quot;文件上传成功！&quot;+e.getMessage());</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            return &quot;forward:/index.jsp&quot;;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">//多文件上传</span></span><br><span class="line">        <span class="meta">@RequestMapping(&quot;/upload&quot;)</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(<span class="meta">@RequestParam(value = &quot;username&quot;,required = false)</span> String username,</span></span></span><br><span class="line"><span class="function"><span class="params">                            <span class="meta">@RequestParam(value = &quot;headerimg&quot;,required = false)</span>MultipartFile[] file</span></span></span><br><span class="line"><span class="function"><span class="params">                ,Model model)</span></span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;文件的信息----&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (MultipartFile multipartFile : file) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!multipartFile.isEmpty())&#123;</span><br><span class="line">                    <span class="comment">//System.out.println(&quot;文件项的名:&quot;+multipartFile.getName());</span></span><br><span class="line">                    <span class="comment">//System.out.println(&quot;文件名:&quot;+multipartFile.getOriginalFilename());</span></span><br><span class="line">                    <span class="comment">//System.out.println(&quot;文件的大小:&quot;+multipartFile.getSize());</span></span><br><span class="line">                    <span class="comment">//文件保存</span></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        multipartFile.transferTo(<span class="keyword">new</span> File(<span class="string">&quot;G:\\fileupload\\&quot;</span>+multipartFile.getOriginalFilename()));</span><br><span class="line">                        model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;文件上传成功！&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        model.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;文件上传失败！&quot;</span>+e.getMessage());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;forward:/index.jsp&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 <figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;$&#123;ctp&#125;/upload&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">用户头像:&lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;headerimg&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">用户名:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;&lt;br/&gt;</span><br><span class="line">&lt;input type=<span class="string">&quot;submit&quot;</span>/&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/Spring-MVC/">Spring MVC</a><a class="post-meta__tags" href="/tags/Ajax/">Ajax</a><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F/">数据格式</a><a class="post-meta__tags" href="/tags/mvc-annotation-driven/">&lt;mvc:annotation-driven&gt;</a><a class="post-meta__tags" href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD/">文件上传下载</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/ducamg/PicGallery@master/DG-PIC/cover/spring_mvc.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/02/17/Spring-MVC-%E5%8D%81%E4%B8%89/"><img class="prev-cover" data-lazy-src="https://cdn.jsdelivr.net/gh/ducamg/PicGallery@master/DG-PIC/cover/spring_mvc.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Spring-MVC(十三)</div></div></a></div><div class="next-post pull-right"><a href="/2020/02/16/Spring-MVC-%E5%8D%81%E4%B8%80/"><img class="next-cover" data-lazy-src="https://cdn.jsdelivr.net/gh/ducamg/PicGallery@master/DG-PIC/cover/spring_mvc.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Spring-MVC(十一)</div></div></a></div></nav></article></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/ducamg/PicGallery@master/DG-PIC/cover/spring_mvc.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By D G</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/ducamg/PicGallery@master/js/utils.js"></script><script src="https://cdn.jsdelivr.net/gh/ducamg/PicGallery@master/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>